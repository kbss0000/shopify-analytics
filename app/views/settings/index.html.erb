<% content_for :page_title, "Settings" %>
<% content_for :page_subtitle, "Manage your preferences and account" %>

<div class="max-w-4xl mx-auto space-y-8">
  
  <!-- Preferences -->
  <div class="card p-8">
    <h3 class="section-title flex items-center mb-6">
      <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
      </svg>
      Appearance & Localization
    </h3>
    
    <div class="space-y-6">
      <!-- Currency Toggle -->
      <div class="flex items-center justify-between p-5 bg-secondary rounded-xl border border-border">
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-foreground mb-1">Display Currency</h4>
          <p class="text-xs text-muted-foreground">Choose your preferred currency for reports.</p>
        </div>
        <div class="flex items-center space-x-2 bg-muted p-1.5 rounded-lg border border-border">
          <%= button_to "USD", "/settings/currency", 
              method: :post,
              params: { currency: "USD" },
              class: "px-4 py-2 text-xs font-semibold rounded-md transition-all duration-200 #{session[:currency] != 'INR' ? 'bg-primary text-primary-foreground' : 'text-muted-foreground hover:text-foreground hover:bg-secondary'}" %>
          <%= button_to "INR", "/settings/currency", 
              method: :post,
              params: { currency: "INR" },
              class: "px-4 py-2 text-xs font-semibold rounded-md transition-all duration-200 #{session[:currency] == 'INR' ? 'bg-primary text-primary-foreground' : 'text-muted-foreground hover:text-foreground hover:bg-secondary'}" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Settings -->
  <div class="card p-8">
    <h3 class="section-title flex items-center mb-6">
      <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
      Account Settings
    </h3>
    
    <%= form_with model: current_tenant, url: settings_account_path, method: :patch, local: true, class: "space-y-6" do |f| %>
      <!-- Name Field -->
      <div>
        <label for="tenant_name" class="block text-sm font-semibold text-foreground mb-2">Store Name</label>
        <%= f.text_field :name, 
            class: "input-field",
            placeholder: "Enter your store name" %>
        <p class="text-xs text-muted-foreground mt-1">This is the name displayed in your dashboard.</p>
      </div>

      <!-- Email Field -->
      <div>
        <label for="tenant_email" class="block text-sm font-semibold text-foreground mb-2">Email Address</label>
        <%= f.email_field :email, 
            class: "input-field",
            placeholder: "your@email.com" %>
        <p class="text-xs text-muted-foreground mt-1">Used for login and notifications.</p>
      </div>

      <!-- Password Section -->
      <div class="pt-4 border-t border-border">
        <h4 class="text-sm font-semibold text-foreground mb-4">Change Password</h4>
        <p class="text-xs text-muted-foreground mb-4">Leave blank if you don't want to change your password.</p>
        
        <div class="space-y-4">
          <!-- Current Password -->
          <div>
            <label for="tenant_current_password" class="block text-sm font-medium text-foreground mb-2">Current Password</label>
            <%= f.password_field :current_password, 
                class: "input-field",
                placeholder: "Enter current password",
                autocomplete: "current-password" %>
          </div>

          <!-- New Password -->
          <div>
            <label for="tenant_password" class="block text-sm font-medium text-foreground mb-2">New Password</label>
            <%= f.password_field :password, 
                class: "input-field",
                placeholder: "Enter new password (min 6 characters)",
                autocomplete: "new-password" %>
          </div>

          <!-- Password Confirmation -->
          <div>
            <label for="tenant_password_confirmation" class="block text-sm font-medium text-foreground mb-2">Confirm New Password</label>
            <%= f.password_field :password_confirmation, 
                class: "input-field",
                placeholder: "Confirm new password",
                autocomplete: "new-password" %>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end pt-4 border-t border-border">
        <%= f.submit "Save Changes", class: "btn-primary cursor-pointer" %>
      </div>
    <% end %>

    <!-- Account Info Section -->
    <div class="mt-8 pt-6 border-t border-border">
      <h4 class="text-sm font-semibold text-foreground mb-4">Account Information</h4>
      <div class="space-y-3">
        <div class="flex justify-between items-center p-3 bg-secondary rounded-lg border border-border">
          <span class="text-sm text-muted-foreground">Account Created</span>
          <span class="text-sm font-medium text-foreground"><%= current_tenant.created_at.strftime("%B %d, %Y") %></span>
        </div>
        <div class="flex justify-between items-center p-3 bg-secondary rounded-lg border border-border">
          <span class="text-sm text-muted-foreground">Last Sign In</span>
          <span class="text-sm font-medium text-foreground">
            <%= current_tenant.last_sign_in_at ? current_tenant.last_sign_in_at.strftime("%B %d, %Y at %I:%M %p") : "Never" %>
          </span>
        </div>
        <% if current_tenant.shopify_connected? %>
          <div class="flex justify-between items-center p-3 bg-secondary rounded-lg border border-border">
            <span class="text-sm text-muted-foreground">Shopify Store</span>
            <span class="text-sm font-medium text-foreground"><%= current_tenant.shopify_domain %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>